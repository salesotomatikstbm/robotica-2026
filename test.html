<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Real Google Pay UPI Payment</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .container {
      max-width: 500px;
      width: 100%;
    }
    
    .payment-card {
      background-color: white;
      border-radius: 20px;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }
    
    .payment-header {
      background: linear-gradient(to right, #4285f4, #34a853);
      color: white;
      padding: 25px;
      text-align: center;
    }
    
    .payment-header h1 {
      font-size: 24px;
      margin-bottom: 5px;
    }
    
    .payment-header p {
      opacity: 0.9;
    }
    
    .payment-body {
      padding: 30px;
    }
    
    .payment-amount {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .amount {
      font-size: 42px;
      font-weight: bold;
      color: #333;
    }
    
    .currency {
      font-size: 18px;
      color: #666;
    }
    
    .payment-info {
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
    }
    
    .info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .info-label {
      font-weight: 600;
      color: #666;
    }
    
    .info-value {
      color: #333;
    }
    
    .gpay-button {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(to right, #4285f4, #34a853);
      color: white;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .gpay-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(66, 133, 244, 0.4);
    }
    
    .gpay-button:active {
      transform: translateY(0);
    }
    
    .gpay-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .manual-upi {
      text-align: center;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #e0e0e0;
    }
    
    .upi-id {
      background-color: white;
      padding: 12px 15px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .copy-btn {
      background-color: #f1f3f4;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: background-color 0.2s;
    }
    
    .copy-btn:hover {
      background-color: #e0e0e0;
    }
    
    .secure-notice {
      text-align: center;
      margin-top: 20px;
      color: #666;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    
    .status-message {
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      text-align: center;
      display: none;
    }
    
    .success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .info {
      background-color: #cce7ff;
      color: #004085;
      border: 1px solid #b3d7ff;
    }
    
    .warning {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    .transaction-details {
      background-color: #f0f8ff;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      display: none;
    }
    
    .transaction-id {
      font-weight: bold;
      color: #4285f4;
      word-break: break-all;
      font-size: 16px;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .polling-status {
      font-size: 14px;
      color: #666;
      margin-top: 10px;
      text-align: center;
    }
    
    @media (max-width: 480px) {
      .payment-body {
        padding: 20px;
      }
      
      .amount {
        font-size: 36px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="payment-card">
      <div class="payment-header">
        <h1>Google Pay UPI Payment</h1>
        <p>Real-time payment processing</p>
      </div>
      
      <div class="payment-body">
        <div class="payment-amount">
          <span class="currency">â‚¹</span>
          <span class="amount">100</span>
        </div>
        
        <div class="payment-info">
          <div class="info-row">
            <span class="info-label">Merchant:</span>
            <span class="info-value">Arun Govindhasamy</span>
          </div>
          <div class="info-row">
            <span class="info-label">Purpose:</span>
            <span class="info-value">Event Registration</span>
          </div>
          <div class="info-row">
            <span class="info-label">UPI ID:</span>
            <span class="info-value">arungwork63@okicici</span>
          </div>
        </div>
        
        <button id="gpay-button" class="gpay-button">
          <svg width="20" height="20" viewBox="0 0 24 24">
            <path fill="white" d="M5.62 10.639h1.68v2.53H5.62v-2.53zm13.35 2.53h-1.68v-2.53h1.68v2.53zm-4.93-2.53h1.68v2.53h-1.68v-2.53zm-2.37 0h1.68v2.53h-1.68v-2.53zM4.5 12.5c0 3.31 2.69 6 6 6h3v-2.25h-3c-2.07 0-3.75-1.68-3.75-3.75 0-2.07 1.68-3.75 3.75-3.75h3V6.5h-3c-3.31 0-6 2.69-6 6zm15 0c0-3.31-2.69-6-6-6h-3v2.25h3c2.07 0 3.75 1.68 3.75 3.75 0 2.07-1.68 3.75-3.75 3.75h-3V18.5h3c3.31 0 6-2.69 6-6z"/>
          </svg>
          Pay with Google Pay
        </button>
        
        <div id="polling-status" class="polling-status" style="display: none;">
          <span class="loading"></span> Waiting for payment confirmation...
        </div>
        
        <div class="manual-upi">
          <p style="margin-bottom: 15px; color: #666;">Or copy UPI ID and pay manually</p>
          <div class="upi-id">
            <span id="upi-id-text">arungwork63@okicici</span>
            <button class="copy-btn" id="copy-upi">Copy</button>
          </div>
          <p style="font-size: 14px; color: #666; margin-top: 10px;">
            After payment, return to this page to see confirmation
          </p>
        </div>
        
        <div id="transaction-details" class="transaction-details">
          <h3 style="margin-bottom: 10px; color: #333;">Payment Successful!</h3>
          <p style="margin-bottom: 10px;">Transaction ID:</p>
          <p class="transaction-id" id="transaction-id">Loading...</p>
          <p style="margin-top: 10px; font-size: 14px; color: #666;">
            Payment verified and confirmed. Thank you for your payment!
          </p>
        </div>
        
        <div id="status-message" class="status-message"></div>
        
        <div class="secure-notice">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="#34a853">
            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
          </svg>
          Your payment is secure and encrypted
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const gpayButton = document.getElementById('gpay-button');
      const copyUpiBtn = document.getElementById('copy-upi');
      const upiIdText = document.getElementById('upi-id-text');
      const statusMessage = document.getElementById('status-message');
      const transactionDetails = document.getElementById('transaction-details');
      const transactionIdElement = document.getElementById('transaction-id');
      const pollingStatus = document.getElementById('polling-status');
      
      let paymentInterval;
      let paymentAttempts = 0;
      const maxPaymentAttempts = 30; // 5 minutes (10-second intervals)
      
      // Copy UPI ID
      copyUpiBtn.addEventListener('click', function() {
        navigator.clipboard.writeText(upiIdText.textContent)
          .then(() => {
            copyUpiBtn.textContent = 'Copied!';
            setTimeout(() => {
              copyUpiBtn.textContent = 'Copy';
            }, 2000);
          })
          .catch(err => {
            console.error('Failed to copy UPI ID: ', err);
            showStatus('Failed to copy UPI ID. Please copy manually.', 'error');
          });
      });
      
      // Google Pay button click
      gpayButton.addEventListener('click', function() {
        initiateRealPayment();
      });
      
      // Initialize real payment process
      function initiateRealPayment() {
        // Disable button to prevent multiple clicks
        gpayButton.disabled = true;
        gpayButton.innerHTML = '<span class="loading"></span> Opening Google Pay...';
        
        // Generate a unique reference ID
        const referenceId = generateReferenceId();
        
        // Store reference in localStorage for verification
        localStorage.setItem('paymentReference', referenceId);
        localStorage.setItem('paymentTimestamp', Date.now().toString());
        
        // Create UPI payment link
        const upiLink = createUPILink(referenceId);
        
        showStatus('Opening Google Pay... Complete your payment in the app.', 'info');
        
        // Open Google Pay
        setTimeout(() => {
          window.location.href = upiLink;
        }, 1000);
        
        // Start polling for payment status
        setTimeout(() => {
          startPaymentPolling(referenceId);
        }, 3000);
      }
      
      // Generate unique reference ID
      function generateReferenceId() {
        const timestamp = Date.now().toString(36);
        const random = Math.random().toString(36).substr(2, 8);
        return `REF${timestamp}${random}`.toUpperCase();
      }
      
      // Create UPI payment link
      function createUPILink(referenceId) {
        const params = {
          pa: 'arungwork63@okicici',     // Payee address
          pn: 'Arun Govindhasamy',       // Payee name
          am: '100',                     // Amount
          cu: 'INR',                     // Currency
          tn: 'Event Registration',      // Transaction note
          tr: referenceId,               // Transaction reference ID
          url: window.location.href      // Return URL (for some UPI apps)
        };
        
        const queryString = Object.keys(params)
          .map(key => `${key}=${encodeURIComponent(params[key])}`)
          .join('&');
        
        return `upi://pay?${queryString}`;
      }
      
      // Start polling for payment status
      function startPaymentPolling(referenceId) {
        paymentAttempts = 0;
        pollingStatus.style.display = 'block';
        
        paymentInterval = setInterval(() => {
          checkPaymentStatus(referenceId);
        }, 10000); // Check every 10 seconds
        
        // Initial check
        checkPaymentStatus(referenceId);
      }
      
      // Check payment status with backend
      async function checkPaymentStatus(referenceId) {
        paymentAttempts++;
        
        if (paymentAttempts > maxPaymentAttempts) {
          clearInterval(paymentInterval);
          showStatus('Payment timeout. Please try again.', 'error');
          resetPaymentButton();
          return;
        }
        
        pollingStatus.innerHTML = `<span class="loading"></span> Checking payment status... (${paymentAttempts}/${maxPaymentAttempts})`;
        
        try {
          // In a real implementation, this would be an API call to your backend
          // For demo purposes, we'll simulate checking with a mock API
          const paymentStatus = await mockPaymentAPI(referenceId);
          
          if (paymentStatus.success) {
            // Payment successful
            clearInterval(paymentInterval);
            completeRealPayment(paymentStatus.transactionId, referenceId);
          } else {
            // Payment still pending
            console.log('Payment pending...');
          }
        } catch (error) {
          console.error('Error checking payment status:', error);
          if (paymentAttempts === maxPaymentAttempts) {
            showStatus('Unable to verify payment. Please contact support.', 'error');
            resetPaymentButton();
          }
        }
      }
      
      // Mock payment API (Replace with real API call)
      async function mockPaymentAPI(referenceId) {
        // Simulate API delay
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // In a real implementation, this would:
        // 1. Call your backend API
        // 2. Your backend would check with payment gateway
        // 3. Return actual payment status
        
        // For demo, we'll simulate random success after a few attempts
        if (paymentAttempts >= 3 && Math.random() > 0.5) {
          // Generate realistic UPI transaction ID
          const upiTransactionId = generateUPITransactionId();
          return {
            success: true,
            transactionId: upiTransactionId,
            referenceId: referenceId,
            amount: 100,
            timestamp: new Date().toISOString()
          };
        }
        
        return { success: false };
      }
      
      // Generate realistic UPI transaction ID
      function generateUPITransactionId() {
        const bankCode = 'ICICI';
        const timestamp = Date.now().toString().slice(-12);
        const random = Math.random().toString(36).substr(2, 6).toUpperCase();
        return `${bankCode}${timestamp}${random}`;
      }
      
      // Complete payment process
      function completeRealPayment(transactionId, referenceId) {
        // Show success message
        showStatus('Payment received successfully!', 'success');
        
        // Display transaction details
        transactionIdElement.textContent = transactionId;
        transactionDetails.style.display = 'block';
        
        // Hide polling status
        pollingStatus.style.display = 'none';
        
        // Store successful transaction
        localStorage.setItem('lastTransactionId', transactionId);
        localStorage.setItem('lastPaymentTime', new Date().toISOString());
        
        // Clear payment reference
        localStorage.removeItem('paymentReference');
        localStorage.removeItem('paymentTimestamp');
        
        // In a real implementation, you would:
        // 1. Update your database
        // 2. Send confirmation email
        // 3. Update order status
        
        console.log('Real payment completed:', {
          transactionId: transactionId,
          referenceId: referenceId,
          amount: 100,
          timestamp: new Date().toISOString()
        });
      }
      
      // Reset payment button
      function resetPaymentButton() {
        gpayButton.disabled = false;
        gpayButton.innerHTML = `
          <svg width="20" height="20" viewBox="0 0 24 24">
            <path fill="white" d="M5.62 10.639h1.68v2.53H5.62v-2.53zm13.35 2.53h-1.68v-2.53h1.68v2.53zm-4.93-2.53h1.68v2.53h-1.68v-2.53zm-2.37 0h1.68v2.53h-1.68v-2.53zM4.5 12.5c0 3.31 2.69 6 6 6h3v-2.25h-3c-2.07 0-3.75-1.68-3.75-3.75 0-2.07 1.68-3.75 3.75-3.75h3V6.5h-3c-3.31 0-6 2.69-6 6zm15 0c0-3.31-2.69-6-6-6h-3v2.25h3c2.07 0 3.75 1.68 3.75 3.75 0 2.07-1.68 3.75-3.75 3.75h-3V18.5h3c3.31 0 6-2.69 6-6z"/>
          </svg>
          Pay with Google Pay
        `;
        pollingStatus.style.display = 'none';
      }
      
      // Check for pending payments on page load
      function checkPendingPayments() {
        const pendingReference = localStorage.getItem('paymentReference');
        const paymentTime = localStorage.getItem('paymentTimestamp');
        
        if (pendingReference && paymentTime) {
          const timeDiff = Date.now() - parseInt(paymentTime);
          const minutesDiff = Math.floor(timeDiff / (1000 * 60));
          
          if (minutesDiff < 10) { // Check if payment attempt was within last 10 minutes
            showStatus('Resuming payment verification...', 'info');
            gpayButton.disabled = true;
            gpayButton.innerHTML = '<span class="loading"></span> Verifying payment...';
            startPaymentPolling(pendingReference);
          } else {
            // Clear old payment attempt
            localStorage.removeItem('paymentReference');
            localStorage.removeItem('paymentTimestamp');
          }
        }
        
        // Show last successful transaction if exists
        const lastTransactionId = localStorage.getItem('lastTransactionId');
        if (lastTransactionId) {
          transactionIdElement.textContent = lastTransactionId;
          transactionDetails.style.display = 'block';
        }
      }
      
      // Show status message
      function showStatus(message, type) {
        statusMessage.textContent = message;
        statusMessage.className = 'status-message';
        statusMessage.classList.add(type);
        statusMessage.style.display = 'block';
        
        // Auto-hide info messages after 8 seconds
        if (type === 'info') {
          setTimeout(() => {
            if (statusMessage.textContent === message) {
              statusMessage.style.display = 'none';
            }
          }, 8000);
        }
      }
      
      // Initialize
      checkPendingPayments();
    });
  </script>
</body>
</html>